<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>J2H - JSON &lt;-&gt; HTML</title>
<script type="text/javascript" charset="UTF-8" src="j2h.js"></script>
<style type="text/css">
* {
    margin: 0;
    padding: 0;
    font-size: 100%;
    box-sizing: border-box;
}
html,body {
    height: 100%;
    font-family: 'Helvetica Neue';
}
h1 {
    font-size: 180%;
    line-height: 150%;
}
ul li {
    list-style-position: inside;
}

header {
    position: absolute;
    height: 3em;
    width: 100%;
    overflow: hidden;
    color: #555;
    background-color: #000;
    border-bottom: 1px #ddd solid;
}
header > * {
    display: inline-block;
    height: 100%;
}
header > h1 {
    position: absolute;
    padding-left: 10px;
    color: #fff;
}
header > p {
    margin-left: 5.6em;
    padding-left: 1ex;
    width: 100%;
    background-color: #fcfcfc;
}
header > *:before {
    display: inline-block;
    content: '.';
    visibility: hidden;
    height: 100%;
    vertical-align: middle;
}


.main {
    height: 100%;
    padding-top: 3em;
}

article {
    height: 70%;
    padding: 1em;
    overflow: auto;
    border-top: 1px #f6f6f6 solid;
}

aside {
    height: 30%;
    overflow: hidden;
    background-color: #fff;
    border-top: 1px #ccc solid;
}
aside > ul {
    position: absolute;
    height: 2em;
    width: 100%;
    padding: 0 1em;
    cursor: row-resize;
    text-align: right;
    background-color: #eee;
    border-bottom: 1px #ccc solid;
}
aside > ul li {
    display: inline-block;
    height: 100%;
}
aside > ul li:before {
    display: inline-block;
    content: '.';
    visibility: hidden;
    height: 100%;
    vertical-align: middle;
}
aside > p {
    height: 100%;
    padding-top: 2em;
    color: #fff;
    border: none;
}
aside > p > textarea {
    height: 100%;
    width: 100%;
    padding: 1em;
    outline-width: thick;
    background-color: transparent;
    border: none;
}
</style>
</head>
<body>
<header>
<h1>J2H</h1>
<p>JSON&lt;-&gt;HTML Editor</p>
</header>
<div class="main">
<!-- editor -->
<article id="html">
<button>+</button>
</article>

<!-- raw text -->
<aside id="json">
<!-- toolbar -->
<ul><li><a href="#">apply</a></li></ul>
<p><textarea></textarea></p>
</aside>

</div>
<!-- controller -->
<script type="text/javascript" charset="UTF-8">

/* mouse tracker */
var TRACK_START = 1 << 0,
    TRACK_PROGRESS = 1 << 1,
    TRACK_END = 1 << 2;

function setMouseTracker( handle, callback )
{
    var origin = {},
        ctx = {},
        setOrigin = function( evt ){
            origin.x = evt.x;
            origin.y = evt.y;
        },
        sendDiff = function( evt, type )
        {
            if( !callback( evt.x - origin.x, evt.y - origin.y, type, ctx ) || 
                type === TRACK_END ){
                onFinish();
            }
        },
        onFinish = function(){
            window.removeEventListener( 'mouseup', onEnd );
            window.removeEventListener( 'mousemove', onTrack );
        },
        onTrack = function( evt ){
            sendDiff( evt, TRACK_PROGRESS );
            return false;
        },
        onEnd = function( evt ){
            sendDiff( evt, TRACK_END );
            return false;
        },
        onStart = function( evt )
        {
            evt.preventDefault();
            setOrigin( evt );
            ctx = {};
            if( callback( origin.x, origin.y, TRACK_START, ctx ) ){
                window.addEventListener( 'mouseup', onEnd );
                window.addEventListener( 'mousemove', onTrack );
            }
            return false;
        };
    
    handle.addEventListener( 'mousedown', onStart );
    
    return {
        clearMouseTracker: function(){
            onFinish();
            handle.removeEventListener( 'mousedown', onStart );
        }
    };
}

/* interface elements */
var JSON_PANE = {
        pane: document.querySelector('#json'),
        toolbar: document.querySelector('#json ul'),
        textarea: document.querySelector('#json textarea')
    },
    HTML_PANE = {
        pane: document.querySelector('#html'),
    },
    CONTENT_HEIGHT = 0,
    MAX_HEIGHT = 0,
    MIN_HEIGHT = 0,
    PER_HEIGHT = 0;

function trackResize( x, y, type, ctx )
{
    var htmlp = HTML_PANE.pane,
        jsonp = JSON_PANE.pane;
    
    if( type === TRACK_START ){
        ctx.height = HTML_PANE.pane.clientHeight;
    }
    else if( type === TRACK_PROGRESS && y )
    {
        var modify = ctx.height + y;
        if( modify > MIN_HEIGHT && modify < MAX_HEIGHT ){
            htmlp.style.height = modify + 'px';
            jsonp.style.height = CONTENT_HEIGHT - modify + 'px';
        }
    }
    else if( type === TRACK_END ){
        htmlp.style.height = HTML_PANE.pane.clientHeight / PER_HEIGHT + '%';
        jsonp.style.height = JSON_PANE.pane.clientHeight / PER_HEIGHT + '%';
    }
    
    return true;
}

function initUI()
{
    var updateConstants = function(){
            CONTENT_HEIGHT = HTML_PANE.pane.clientHeight + JSON_PANE.pane.clientHeight;
            MAX_HEIGHT = CONTENT_HEIGHT - JSON_PANE.toolbar.clientHeight * 2;
            MIN_HEIGHT = JSON_PANE.toolbar.clientHeight * 2;
            PER_HEIGHT = CONTENT_HEIGHT / 100;
        };
    
    window.addEventListener('resize', updateConstants );
    updateConstants();
    setMouseTracker( JSON_PANE.toolbar, trackResize );
}

initUI();

</script>
</body>
</html>

